<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amistosos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #0f0f0f;  /* Fundo preto */
            color: #e0e0e0;  /* Cor do texto em um tom claro */
            margin: 0;
            padding: 20px;
        }

        h1 {
            font-size: 28px;
            color: #00FF00;  /* Verde gamer para o título */
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #222222;  /* Fundo escuro da tabela */
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.6);
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #333333;  /* Cor das bordas da tabela */
        }

        th {
            background-color: #444444;  /* Cor de fundo mais escura para os cabeçalhos */
            color: #00FF00;  /* Verde gamer nos cabeçalhos */
        }

        tr:hover {
            background-color: #333333;  /* Cor para linhas ao passar o mouse */
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            table {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <body>
        <h1>Tabela de rodadas</h1>
        <div id="tabelaResultado"></div>
    
        <script>
            const arquivosCSV = [
                '29/1-rondo-normal-duo-2024-11-29t22_51_09+00_00.csv',
                '29/2-sanhok-normal-squad-fpp-2024-11-29t23_23_40+00_00.csv',
                '29/3-taego-normal-squad-2024-11-29t23_52_39+00_00.csv',
                '29/4-miramar-normal-squad-2024-11-30t00_36_43+00_00.csv',
                '29/5-paramo-normal-squad-2024-11-30t01_13_28+00_00.csv',
                '29/6-karakin-normal-squad-2024-11-30t01_50_06+00_00.csv',
                '29/7-erangel-normal-squad-2024-11-30t02_19_33+00_00.csv',
                '29/8-vikendi-normal-squad-2024-11-30t02_51_58+00_00.csv'
            ];
    
            const nomesMapas = [
                'Rondo ', 
                'Sanhok ',
                'Taego ',
                'Miramar ',
                'Paramo ',
                'Karakin ',
                'Erangel ',
                'Vikendi'   
            ];
    
            let dadosCSV = [];
    
            // Função para ler um arquivo CSV
            function lerCSV(url, index) {
                Papa.parse(url, {
                    download: true,
                    complete: function (result) {
                        dadosCSV = result.data;
                        console.log("CSV carregado de:", url);
                        processarDados(index);  // Passar o índice para identificar a tabela
                    },
                    header: true
                });
            }
    
            // Função para processar os dados e agrupar as informações para cada CSV
            function processarDados(index) {
                let times = {};
    
                // Agrupar jogadores por time
                dadosCSV.forEach(linha => {
                    const time = linha["Team Name"];
                    const kills = parseInt(linha["Kills"]) || 0;  // Garantir que as kills sejam um número válido
                    const posicao = linha["Win Place"];
    
                    // Ignorar linhas que não contêm um time ou posição válida
                    if (!time || isNaN(kills) || !posicao) return;
    
                    if (!times[time]) {
                        times[time] = {
                            killsTime: 0,
                            posicao: parseInt(posicao) // Garantir que a posição seja um número
                        };
                    }
    
                    // Somar as kills do time
                    times[time].killsTime += kills;
                });
    
                // Converter o objeto times em um array
                let timesOrdenados = Object.keys(times).map(time => {
                    return {
                        nomeTime: time,
                        posicao: times[time].posicao,
                        killsTime: times[time].killsTime
                    };
                });
    
                // Ordenar os times pela quantidade de kills (decrescente) e pela posição (crescente)
                timesOrdenados.sort((a, b) => {
                    if (b.killsTime === a.killsTime) {
                        return a.posicao - b.posicao;  // Caso de empate, o time com a melhor posição ganha
                    }
                    return b.killsTime - a.killsTime; // Ordenar pelas kills de forma decrescente
                });
    
                // Atribuir pontos de acordo com a posição (10 pontos para o 1º, 9 para o 2º, etc.)
                timesOrdenados.forEach((time, index) => {
                    time.pontosPosicao = 10 - index; // Atribuindo pontos pela posição, 10 para o 1º, 9 para o 2º, etc.
                    if (index >= 10) {
                        time.pontosPosicao = 0; // Times além da 10ª posição recebem 0 pontos
                    }
                    // Soma os pontos da posição com as kills
                    time.pontos = time.pontosPosicao + time.killsTime;
                });
    
                // Preparar dados para exibir na tabela
                let tabela = `<h2>Jogo #${index + 1} - ${nomesMapas[index]}</h2>`;  // Exibir o nome do mapa
                tabela += "<table>";
                tabela += "<thead><tr><th>Posição</th><th>Nome do Time</th><th>Kills do Time</th><th>Pontos por Posição</th><th>Pontos Totais</th></tr></thead>";
                tabela += "<tbody>";
    
                // Mostrar os times e seus totais
                timesOrdenados.forEach((time, index) => {
                    tabela += "<tr>";
                    tabela += `<td>${index + 1}</td>`;  // Mostrar posição na tabela
                    tabela += `<td>${time.nomeTime}</td>`;
                    tabela += `<td>${time.killsTime}</td>`;
                    tabela += `<td>${time.pontosPosicao}</td>`;  // Mostrar a pontuação pela posição
                    tabela += `<td>${time.pontos}</td>`;  // Mostrar a pontuação total (posição + kills)
                    tabela += "</tr>";
                });
    
                tabela += "</tbody></table>";
                document.getElementById("tabelaResultado").innerHTML += tabela;  // Adicionar a tabela ao conteúdo
            }
    
            // Carregar todos os arquivos CSV predefinidos
            arquivosCSV.forEach((arquivo, index) => {
                lerCSV(arquivo, index); // Ler cada arquivo CSV automaticamente e passar o índice
            });
        </script>
    </body>

</html>
